
<div class="app">

  <%= render partial: 'partials/app_header' %>

  <div class="container">

    <div class="row">

      <div class="col-xs-6 col-md-4" id="sidebar" role="navigation">

        <div class="list-group">
          <% @posts.each do |post| %>
            <a href="#" data-post-id="<%= post.id %>" class="list-group-item post-list"><%= post.title %></a>
          <% end %>
        </div>
      </div><!--/span-->

      <div class="col-xs-12 col-sm-6 col-md-8">

        <div id="list_post">
          <p style="color:#aaa;font-size:30px">&lt;-- Select a post...</p>
        </div>

      </div><!--/span-->

    </div><!--/row-->

    <hr>

    <footer>
    </footer>

  </div><!--/.container-->

</div>

<% content_for :footer_js do %>
<script type="text/javascript">

  $(function(){
    'use strict';

    // post list
    $('.post-list').on('click', function(e){
      e.preventDefault();
      var $this = $(this);

      $this.siblings().removeClass('active');
      $this.addClass('active');
      var id = $this.data('postId');
      $.get('/posts/show_fragment', {
        'id': id,
      })
      .done(function(data){
        $('#list_post').html(data);
      });
    });

    // initial post selection.
    (function(){
      // open post when `id` parameter set.
      // /?a=b&c=123  ==>  {"a": "b", "c": "123"}
      var getQueryParams = function() {
        var query = location.search.split("+").join(" "),
            params = {},
            tokens,
            re = /[?&]?([^=]+)=([^&]*)/g;
        while (tokens = re.exec(query)) {
          params[decodeURIComponent(tokens[1])]
            = decodeURIComponent(tokens[2]);
        }
        return params;
      }
      var id_param = getQueryParams()["id"];
      if(id_param) {
        $(".post-list[data-post-id='" + id_param + "']").addClass('active');
        $.get('/posts/show_fragment', {
          'id': id_param,
        })
        .done(function(data){
          $('#list_post').html(data);
        });
      }
    })();

    // search form
    $('#app-search-form input').on('focus', function(){
      $(this).parents('#app-search-form').animate({width: '600px'});
    }).on('blur', function(){
      $(this).parents('#app-search-form').animate({width: '200px'});
    });
  });
</script>
<% end %>
